<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Tracker</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0f0f0f;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  width: 95%;
  max-width: 420px;
  background: #1b1b1b;
  padding: 20px;
  border-radius: 18px;
}

h2 { text-align: center; }

input, button {
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  border-radius: 10px;
  border: none;
  font-size: 15px;
}

button {
  cursor: pointer;
  font-weight: bold;
}

.habitBtn {
  background: #333;
  color: white;
}

.completed {
  background: #4CAF50 !important;
}

.stats {
  margin-top: 15px;
  font-size: 14px;
  background: #222;
  padding: 10px;
  border-radius: 10px;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸ”¥ Multi Habit Tracker</h2>

<!-- LOGIN -->
<div id="loginBox">
  <input type="password" id="passwordInput" placeholder="Nháº­p máº­t kháº©u">
  <button onclick="checkPassword()">VÃ o</button>
  <div id="loginStatus"></div>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

<button onclick="logout()" style="background:#444;">ðŸšª ThoÃ¡t</button>

<input type="date" id="datePicker">

<input type="text" id="newHabit" placeholder="ThÃªm habit má»›i">
<button onclick="addHabit()">âž• ThÃªm Habit</button>

<div id="habitList"></div>

<div class="stats">
<h4>ðŸ“Š Thá»‘ng kÃª tá»•ng</h4>
<div id="statsBox"></div>
</div>

</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, getDocs, collection } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
  authDomain: "runnn-e4e8c.firebaseapp.com",
  projectId: "runnn-e4e8c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const appBox = document.getElementById("appBox");
const dateInput = document.getElementById("datePicker");

dateInput.value = new Date().toISOString().split("T")[0];

let habits = JSON.parse(localStorage.getItem("habitsList")) || ["reading", "running"];

// ===== LOGIN =====
window.checkPassword = function() {
  if (passwordInput.value === "1111") {
    localStorage.setItem("loggedIn", "true");
    showApp();
  } else {
    loginStatus.innerText = "Sai máº­t kháº©u!";
  }
};

window.logout = function() {
  localStorage.removeItem("loggedIn");
  location.reload();
};

function showApp() {
  loginBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  loadHabits();
  loadStats();
}

if (localStorage.getItem("loggedIn") === "true") {
  showApp();
}

// ===== HABIT =====
window.addHabit = function() {
  const name = newHabit.value.trim().toLowerCase();
  if (!name) return;

  if (!habits.includes(name)) {
    habits.push(name);
    localStorage.setItem("habitsList", JSON.stringify(habits));
    loadHabits();
  }
  newHabit.value = "";
};

async function loadHabits() {
  habitList.innerHTML = "";

  const snap = await getDoc(doc(db, "habits", dateInput.value));
  const data = snap.exists() ? snap.data() : {};

  habits.forEach(habit => {
    const btn = document.createElement("button");
    btn.innerText = habit;
    btn.className = "habitBtn";

    if (data[habit]) btn.classList.add("completed");

    btn.onclick = async () => {
      await setDoc(doc(db, "habits", dateInput.value),
        { [habit]: !data[habit] }, { merge: true });
      loadHabits();
      loadStats();
    };

    habitList.appendChild(btn);
  });
}

async function loadStats() {
  const snapshot = await getDocs(collection(db, "habits"));
  let totals = {};

  snapshot.forEach(doc => {
    const d = doc.data();
    habits.forEach(h => {
      if (d[h]) {
        totals[h] = (totals[h] || 0) + 1;
      }
    });
  });

  statsBox.innerHTML = "";
  habits.forEach(h => {
    const div = document.createElement("div");
    div.innerText = h + ": " + (totals[h] || 0) + " ngÃ y";
    statsBox.appendChild(div);
  });
}

dateInput.addEventListener("change", loadHabits);
</script>

</body>
</html>
