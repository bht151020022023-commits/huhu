<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Fire</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Habit Fire">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:linear-gradient(180deg,#000,#1a0000,#330000);
color:white;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
}

.container{
width:95%;
max-width:420px;
background:rgba(0,0,0,0.6);
padding:20px;
border-radius:20px;
backdrop-filter:blur(10px);
}

h2{text-align:center;}

button,input{
width:100%;
padding:14px;
margin:8px 0;
border-radius:14px;
border:none;
font-size:16px;
}

button{
background:#ff4500;
color:white;
font-weight:bold;
cursor:pointer;
}

input{
background:rgba(255,255,255,0.1);
color:white;
}

.stats{
margin-top:15px;
background:rgba(255,255,255,0.1);
padding:12px;
border-radius:14px;
font-size:14px;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="container">

<h2>ğŸ”¥ Habit Fire</h2>

<div id="loginBox">
<input type="password" id="passwordInput" placeholder="Nháº­p máº­t kháº©u">
<button id="loginBtn">VÃ o</button>
<div id="loginStatus"></div>
</div>

<div id="appBox" class="hidden">

<button id="logoutBtn" style="background:#444;">ğŸšª ThoÃ¡t</button>

<input type="date" id="datePicker">

<button id="btnRunning">ğŸƒ Cháº¡y bá»™</button>
<div id="runningBox" class="hidden">
<input type="number" id="runningInput" placeholder="Nháº­p km">
<button id="saveRunningBtn">LÆ°u</button>
</div>

<button id="btnReading">ğŸ“š Äá»c sÃ¡ch</button>
<div id="readingBox" class="hidden">
<input type="number" id="readingInput" placeholder="Nháº­p trang">
<button id="saveReadingBtn">LÆ°u</button>
</div>

<button id="btnStudy">â± Há»c / Táº­p</button>
<div id="studyBox" class="hidden">
<input type="number" id="studyInput" placeholder="Nháº­p giá»">
<button id="saveStudyBtn">LÆ°u</button>
</div>

<div class="stats">
<h4>ğŸ“Š Tá»•ng cá»™ng</h4>
<div id="statsBox"></div>
</div>

</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
authDomain:"runnn-e4e8c.firebaseapp.com",
projectId:"runnn-e4e8c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const loginBox=document.getElementById("loginBox");
const appBox=document.getElementById("appBox");
const passwordInput=document.getElementById("passwordInput");
const loginBtn=document.getElementById("loginBtn");
const logoutBtn=document.getElementById("logoutBtn");

const dateInput=document.getElementById("datePicker");
dateInput.value=new Date().toISOString().split("T")[0];

const runningBox=document.getElementById("runningBox");
const readingBox=document.getElementById("readingBox");
const studyBox=document.getElementById("studyBox");

const statsBox=document.getElementById("statsBox");

loginBtn.addEventListener("click",()=>{
if(passwordInput.value==="1111"){
localStorage.setItem("loggedIn","true");
showApp();
}else{
loginStatus.innerText="Sai máº­t kháº©u!";
}
});

logoutBtn.addEventListener("click",()=>{
localStorage.removeItem("loggedIn");
location.reload();
});

function showApp(){
loginBox.classList.add("hidden");
appBox.classList.remove("hidden");
loadStats();
}

if(localStorage.getItem("loggedIn")==="true"){
showApp();
}

document.getElementById("btnRunning").onclick=()=>runningBox.classList.toggle("hidden");
document.getElementById("btnReading").onclick=()=>readingBox.classList.toggle("hidden");
document.getElementById("btnStudy").onclick=()=>studyBox.classList.toggle("hidden");

document.getElementById("saveRunningBtn").onclick=async()=>{
const value=Number(runningInput.value);
if(!value)return alert("Nháº­p km!");
await setDoc(doc(db,"habits",dateInput.value),{running:value},{merge:true});
runningInput.value="";
runningBox.classList.add("hidden");
loadStats();
};

document.getElementById("saveReadingBtn").onclick=async()=>{
const value=Number(readingInput.value);
if(!value)return alert("Nháº­p trang!");
await setDoc(doc(db,"habits",dateInput.value),{reading:value},{merge:true});
readingInput.value="";
readingBox.classList.add("hidden");
loadStats();
};

document.getElementById("saveStudyBtn").onclick=async()=>{
const value=Number(studyInput.value);
if(!value)return alert("Nháº­p giá»!");
await setDoc(doc(db,"habits",dateInput.value),{study:value},{merge:true});
studyInput.value="";
studyBox.classList.add("hidden");
loadStats();
};

async function loadStats(){
const snapshot=await getDocs(collection(db,"habits"));
let totalRunning=0,totalReading=0,totalStudy=0;
snapshot.forEach(doc=>{
const d=doc.data();
totalRunning+=d.running||0;
totalReading+=d.reading||0;
totalStudy+=d.study||0;
});
statsBox.innerHTML=`
ğŸƒ ${totalRunning} km<br>
ğŸ“š ${totalReading} trang<br>
â± ${totalStudy} giá»
`;
}

</script>
</body>
</html>
