<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Habit Tracker Pro</title>
<style>
body { font-family: Arial; text-align:center; background:#111; color:white; }
input { padding:8px; margin:5px; border-radius:6px; border:none; }
button { padding:8px 15px; margin:5px; border:none; border-radius:6px; cursor:pointer; }
.box { background:#222; padding:20px; margin:20px auto; border-radius:10px; width:300px; }
</style>
</head>
<body>

<h1>ğŸ”¥ Habit Tracker</h1>

<div id="authBox" class="box">
<h3>ÄÄƒng kÃ½ / ÄÄƒng nháº­p</h3>
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button id="registerBtn">Register</button>
<button id="loginBtn">Login</button>
<p id="authStatus"></p>
</div>

<div id="appBox" class="box" style="display:none;">
<h3>Habit</h3>
<p id="userInfo"></p>
<input type="date" id="datePicker"><br>
<button id="readingBtn">ğŸ“š Äá»c sÃ¡ch</button>
<button id="runningBtn">ğŸƒ Cháº¡y bá»™</button>
<button id="logoutBtn">Logout</button>
<p id="status"></p>
<p id="todayStatus"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
  authDomain: "runnn-e4e8c.firebaseapp.com",
  projectId: "runnn-e4e8c",
  storageBucket: "runnn-e4e8c.firebasestorage.app",
  messagingSenderId: "45995361250",
  appId: "1:45995361250:web:6d07990d673eee92e4afbb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authBox = document.getElementById("authBox");
const appBox = document.getElementById("appBox");
const authStatus = document.getElementById("authStatus");
const status = document.getElementById("status");
const todayStatus = document.getElementById("todayStatus");
const dateInput = document.getElementById("datePicker");
dateInput.value = new Date().toISOString().split("T")[0];

let currentUser = null;

document.getElementById("registerBtn").onclick = async () => {
  try {
    await createUserWithEmailAndPassword(auth, email.value, password.value);
    authStatus.innerText = "ÄÄƒng kÃ½ thÃ nh cÃ´ng!";
  } catch (e) {
    authStatus.innerText = e.message;
  }
};

document.getElementById("loginBtn").onclick = async () => {
  try {
    await signInWithEmailAndPassword(auth, email.value, password.value);
  } catch (e) {
    authStatus.innerText = e.message;
  }
};

document.getElementById("logoutBtn").onclick = () => signOut(auth);

onAuthStateChanged(auth, user => {
  if (user) {
    currentUser = user;
    authBox.style.display = "none";
    appBox.style.display = "block";
    userInfo.innerText = "Xin chÃ o: " + user.email;
    loadData();
  } else {
    authBox.style.display = "block";
    appBox.style.display = "none";
  }
});

async function loadData() {
  const docRef = doc(db, "users", currentUser.uid, "habits", dateInput.value);
  const snap = await getDoc(docRef);

  if (snap.exists()) {
    const data = snap.data();
    todayStatus.innerText =
      "ğŸ“š: " + (data.reading ? "âœ”" : "âœ˜") +
      " | ğŸƒ: " + (data.running ? "âœ”" : "âœ˜");
  } else {
    todayStatus.innerText = "ChÆ°a cÃ³ dá»¯ liá»‡u";
  }
}

document.getElementById("readingBtn").onclick = async () => {
  const docRef = doc(db, "users", currentUser.uid, "habits", dateInput.value);
  await setDoc(docRef, { reading: true }, { merge: true });
  status.innerText = "ÄÃ£ lÆ°u Ä‘á»c sÃ¡ch!";
  loadData();
};

document.getElementById("runningBtn").onclick = async () => {
  const docRef = doc(db, "users", currentUser.uid, "habits", dateInput.value);
  await setDoc(docRef, { running: true }, { merge: true });
  status.innerText = "ÄÃ£ lÆ°u cháº¡y bá»™!";
  loadData();
};

dateInput.addEventListener("change", loadData);
</script>

</body>
</html>
