<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Habit Fire</title>

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:linear-gradient(180deg,#000,#1a0000,#330000);
color:white;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
}

.container{
width:95%;
max-width:420px;
background:rgba(0,0,0,0.6);
padding:20px;
border-radius:20px;
backdrop-filter:blur(10px);
}

h2{text-align:center;}

.mainBtn{
width:100%;
padding:14px;
margin:8px 0;
border-radius:14px;
border:none;
font-size:16px;
font-weight:bold;
color:white;
cursor:pointer;
}

.runBtn{background:linear-gradient(45deg,#ff3c00,#ff7300);}
.readBtn{background:linear-gradient(45deg,#0066ff,#00c3ff);}
.studyBtn{background:linear-gradient(45deg,#7b00ff,#c300ff);}

input{
width:100%;
padding:12px;
margin:6px 0;
border-radius:12px;
border:none;
background:rgba(255,255,255,0.1);
color:white;
font-size:15px;
}

.smallBtn{
padding:6px 12px;
font-size:13px;
background:#00c853;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
margin-top:6px;
}

.hidden{display:none;}

.card{
background:rgba(255,255,255,0.07);
padding:10px;
border-radius:12px;
margin-bottom:10px;
}

.monthHeader{
background:#222;
padding:10px;
border-radius:10px;
cursor:pointer;
margin-top:8px;
}

.monthContent{
overflow:hidden;
max-height:0;
transition:max-height 0.4s ease;
}

.monthContent.open{
max-height:200px;
}

.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
display:flex;
justify-content:center;
align-items:center;
opacity:0;
pointer-events:none;
transition:0.3s;
}

.modal.open{
opacity:1;
pointer-events:auto;
}

.modalContent{
background:#111;
padding:20px;
border-radius:18px;
width:90%;
max-width:350px;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ”¥ Habit Fire</h2>

<div id="loginBox">
<input type="password" id="passwordInput" placeholder="Nháº­p máº­t kháº©u">
<button class="mainBtn runBtn" id="loginBtn">VÃ o</button>
<div id="loginStatus"></div>
</div>

<div id="appBox" class="hidden">

<button class="mainBtn" style="background:#444;" id="logoutBtn">ğŸšª ThoÃ¡t</button>

<input type="date" id="datePicker">

<button class="mainBtn runBtn" onclick="toggleBox('runningBox')">ğŸƒ Cháº¡y bá»™</button>
<div id="runningBox" class="hidden">
<input type="number" id="runningInput" placeholder="Nháº­p km">
<button class="smallBtn" onclick="saveData('running')">LÆ°u</button>
</div>

<button class="mainBtn readBtn" onclick="toggleBox('readingBox')">ğŸ“š Äá»c sÃ¡ch</button>
<div id="readingBox" class="hidden">
<input type="number" id="readingInput" placeholder="Nháº­p trang">
<button class="smallBtn" onclick="saveData('reading')">LÆ°u</button>
</div>

<button class="mainBtn studyBtn" onclick="toggleBox('studyBox')">â± Há»c / Táº­p</button>
<div id="studyBox" class="hidden">
<input type="number" id="studyInput" placeholder="Nháº­p giá»">
<button class="smallBtn" onclick="saveData('study')">LÆ°u</button>
</div>

<button class="mainBtn" style="background:#333;" onclick="toggleHistory()">ğŸ“ Lá»‹ch sá»­ nháº­p</button>
<div id="historyContainer" class="hidden"></div>

<button class="mainBtn" style="background:#222;" onclick="toggleMonthly()">ğŸ“Š Tá»•ng káº¿t thÃ¡ng</button>
<div id="monthlyContainer" class="hidden"></div>

</div>
</div>

<div id="editModal" class="modal">
  <div class="modalContent">
    <h3 id="editTitle"></h3>
    <input type="number" id="editRunning">
    <input type="number" id="editReading">
    <input type="number" id="editStudy">
    <button class="smallBtn" onclick="saveEdit()">LÆ°u</button>
  </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
authDomain:"runnn-e4e8c.firebaseapp.com",
projectId:"runnn-e4e8c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let currentEditDate="";

loginBtn.onclick=()=>{
if(passwordInput.value==="1111"){
localStorage.setItem("loggedIn","true");
loginBox.classList.add("hidden");
appBox.classList.remove("hidden");
}else{
loginStatus.innerText="Sai máº­t kháº©u!";
}
};

if(localStorage.getItem("loggedIn")==="true"){
loginBox.classList.add("hidden");
appBox.classList.remove("hidden");
}

logoutBtn.onclick=()=>{
localStorage.removeItem("loggedIn");
location.reload();
};

window.toggleBox=id=>document.getElementById(id).classList.toggle("hidden");

window.saveData=async function(type){
const date=datePicker.value;
const value=Number(document.getElementById(type+"Input").value);
await setDoc(doc(db,"habits",date),{[type]:value},{merge:true});
document.getElementById(type+"Input").value="";
};

window.toggleHistory=function(){
if(historyContainer.classList.contains("hidden")){
loadHistory();
}else{
historyContainer.classList.add("hidden");
}
};

window.toggleMonthly=function(){
if(monthlyContainer.classList.contains("hidden")){
loadMonthly();
}else{
monthlyContainer.classList.add("hidden");
}
};

async function loadHistory(){
historyContainer.innerHTML="";
historyContainer.classList.remove("hidden");

const snapshot=await getDocs(collection(db,"habits"));
let docs=[];
snapshot.forEach(doc=>docs.push({date:doc.id,...doc.data()}));
docs.sort((a,b)=>b.date.localeCompare(a.date));

docs.forEach(d=>{
const r=d.running||0;
const rd=d.reading||0;
const s=d.study||0;

// Náº¿u 0 0 0 thÃ¬ bá» qua
if(r===0 && rd===0 && s===0) return;

const card=document.createElement("div");
card.className="card";
card.innerHTML=`
<strong>${d.date}</strong><br>
ğŸƒ ${r} km |
ğŸ“š ${rd} trang |
â± ${s} giá»
<br>
<button class="smallBtn" onclick="openEdit('${d.date}',${r},${rd},${s})">âœï¸ Sá»­a</button>
`;
historyContainer.appendChild(card);
});
}

async function loadMonthly(){
monthlyContainer.innerHTML="";
monthlyContainer.classList.remove("hidden");

const snapshot=await getDocs(collection(db,"habits"));
let monthly={};

snapshot.forEach(doc=>{
const d={date:doc.id,...doc.data()};
const month=d.date.slice(0,7);
if(!monthly[month]) monthly[month]={running:0,reading:0,study:0};
monthly[month].running+=d.running||0;
monthly[month].reading+=d.reading||0;
monthly[month].study+=d.study||0;
});

for(const m in monthly){
const header=document.createElement("div");
header.className="monthHeader";
header.innerText=m;

const content=document.createElement("div");
content.className="monthContent";
content.innerHTML=`
<div class="card">
ğŸƒ ${monthly[m].running} km<br>
ğŸ“š ${monthly[m].reading} trang<br>
â± ${monthly[m].study} giá»
</div>
`;

header.onclick=()=>content.classList.toggle("open");

monthlyContainer.appendChild(header);
monthlyContainer.appendChild(content);
}
}

window.openEdit=function(date,r,rd,s){
currentEditDate=date;
editModal.classList.add("open");
editTitle.innerText="Chá»‰nh ngÃ y "+date;
editRunning.value=r;
editReading.value=rd;
editStudy.value=s;
};

window.saveEdit=async function(){
await setDoc(doc(db,"habits",currentEditDate),{
running:Number(editRunning.value),
reading:Number(editReading.value),
study:Number(editStudy.value)
});
editModal.classList.remove("open");
loadHistory();
};

editModal.onclick=(e)=>{
if(e.target===editModal){
editModal.classList.remove("open");
}
};

</script>
</body>
</html>
