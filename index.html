<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Habit Tracker</title>
<style>
body { font-family: Arial; text-align:center; background:#111; color:white; }
button { padding:10px 18px; margin:6px; border:none; border-radius:6px; cursor:pointer; }
.box { background:#222; padding:20px; margin:20px auto; border-radius:10px; width:320px; }
input { padding:6px; margin:5px; border-radius:6px; border:none; text-align:center; }
</style>
</head>
<body>

<h1>ğŸ”¥ Habit Tracker</h1>

<!-- LOGIN BOX -->
<div id="loginBox" class="box">
<h3>Nháº­p máº­t kháº©u Ä‘á»ƒ vÃ o web</h3>
<input type="password" id="passwordInput" placeholder="Nháº­p máº­t kháº©u"><br>
<button onclick="checkPassword()">VÃ o</button>
<p id="loginStatus"></p>
</div>

<!-- APP -->
<div id="appBox" class="box" style="display:none;">
<input type="date" id="datePicker"><br>
<button id="readingBtn">ğŸ“š Äá»c sÃ¡ch</button>
<button id="runningBtn">ğŸƒ Cháº¡y bá»™</button>
<button onclick="logout()">ThoÃ¡t</button>
<p id="status"></p>
<p id="todayStatus"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
  authDomain: "runnn-e4e8c.firebaseapp.com",
  projectId: "runnn-e4e8c",
  storageBucket: "runnn-e4e8c.firebasestorage.app",
  messagingSenderId: "45995361250",
  appId: "1:45995361250:web:6d07990d673eee92e4afbb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const appBox = document.getElementById("appBox");
const dateInput = document.getElementById("datePicker");
const status = document.getElementById("status");
const todayStatus = document.getElementById("todayStatus");

dateInput.value = new Date().toISOString().split("T")[0];

window.checkPassword = function() {
  const pass = document.getElementById("passwordInput").value;

  if (pass === "1111") {
    loginBox.style.display = "none";
    appBox.style.display = "block";
    localStorage.setItem("loggedIn", "true");
    loadData();
  } else {
    document.getElementById("loginStatus").innerText = "Sai máº­t kháº©u!";
  }
};

window.logout = function() {
  localStorage.removeItem("loggedIn");
  location.reload();
};

if (localStorage.getItem("loggedIn") === "true") {
  loginBox.style.display = "none";
  appBox.style.display = "block";
  loadData();
}

async function loadData() {
  const docRef = doc(db, "habits", dateInput.value);
  const snap = await getDoc(docRef);

  if (snap.exists()) {
    const data = snap.data();
    todayStatus.innerText =
      "ğŸ“š: " + (data.reading ? "âœ”" : "âœ˜") +
      " | ğŸƒ: " + (data.running ? "âœ”" : "âœ˜");
  } else {
    todayStatus.innerText = "ChÆ°a cÃ³ dá»¯ liá»‡u";
  }
}

document.getElementById("readingBtn").onclick = async () => {
  const docRef = doc(db, "habits", dateInput.value);
  await setDoc(docRef, { reading: true }, { merge: true });
  status.innerText = "ÄÃ£ lÆ°u Ä‘á»c sÃ¡ch!";
  loadData();
};

document.getElementById("runningBtn").onclick = async () => {
  const docRef = doc(db, "habits", dateInput.value);
  await setDoc(docRef, { running: true }, { merge: true });
  status.innerText = "ÄÃ£ lÆ°u cháº¡y bá»™!";
  loadData();
};

dateInput.addEventListener("change", loadData);
</script>

</body>
</html>
