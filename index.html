<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Habit Fire</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Habit Fire">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(180deg,#000000,#1a0000,#330000);
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  width: 95%;
  max-width: 420px;
  background: rgba(0,0,0,0.6);
  padding: 20px;
  border-radius: 20px;
  backdrop-filter: blur(10px);
}

h2 { text-align:center; }

button,input {
  width: 100%;
  padding: 14px;
  margin: 8px 0;
  border-radius: 14px;
  border: none;
  font-size: 16px;
}

button {
  background: #ff4500;
  color: white;
  font-weight: bold;
}

input {
  background: rgba(255,255,255,0.1);
  color: white;
}

.stats {
  margin-top: 15px;
  background: rgba(255,255,255,0.1);
  padding: 12px;
  border-radius: 14px;
  font-size: 14px;
}

.hidden { display:none; }
</style>
</head>

<body>

<div class="container">

<h2>ğŸ”¥ Habit Fire</h2>

<div id="loginBox">
  <input type="password" id="passwordInput" placeholder="Nháº­p máº­t kháº©u">
  <button onclick="checkPassword()">VÃ o</button>
  <div id="loginStatus"></div>
</div>

<div id="appBox" class="hidden">

<button onclick="logout()" style="background:#444;">ğŸšª ThoÃ¡t</button>

<input type="date" id="datePicker">

<button onclick="toggle('running')">ğŸƒ Cháº¡y bá»™</button>
<div id="runningBox" class="hidden">
  <input type="number" id="runningInput" placeholder="Nháº­p km">
  <button onclick="saveRunning()">LÆ°u</button>
</div>

<button onclick="toggle('reading')">ğŸ“š Äá»c sÃ¡ch</button>
<div id="readingBox" class="hidden">
  <input type="number" id="readingInput" placeholder="Nháº­p trang">
  <button onclick="saveReading()">LÆ°u</button>
</div>

<button onclick="toggle('study')">â± Há»c / Táº­p</button>
<div id="studyBox" class="hidden">
  <input type="number" id="studyInput" placeholder="Nháº­p giá»">
  <button onclick="saveStudy()">LÆ°u</button>
</div>

<div class="stats">
<h4>ğŸ“Š Tá»•ng cá»™ng</h4>
<div id="statsBox"></div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDocs, collection } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDynXh5cyWlMe0CikNUMnFqPaL8LASm4",
  authDomain: "runnn-e4e8c.firebaseapp.com",
  projectId: "runnn-e4e8c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const appBox = document.getElementById("appBox");
const dateInput = document.getElementById("datePicker");

dateInput.value = new Date().toISOString().split("T")[0];

window.checkPassword = function() {
  if (passwordInput.value === "1111") {
    localStorage.setItem("loggedIn", "true");
    showApp();
  } else {
    loginStatus.innerText = "Sai máº­t kháº©u!";
  }
};

window.logout = function() {
  localStorage.removeItem("loggedIn");
  location.reload();
};

function showApp() {
  loginBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  loadStats();
}

if (localStorage.getItem("loggedIn") === "true") {
  showApp();
}

window.toggle = function(type) {
  document.getElementById(type + "Box").classList.toggle("hidden");
};

async function saveRunning() {
  await setDoc(doc(db,"habits",dateInput.value),
  { running:Number(runningInput.value) },{merge:true});
  runningBox.classList.add("hidden");
  loadStats();
}

async function saveReading() {
  await setDoc(doc(db,"habits",dateInput.value),
  { reading:Number(readingInput.value) },{merge:true});
  readingBox.classList.add("hidden");
  loadStats();
}

async function saveStudy() {
  await setDoc(doc(db,"habits",dateInput.value),
  { study:Number(studyInput.value) },{merge:true});
  studyBox.classList.add("hidden");
  loadStats();
}

async function loadStats(){
  const snapshot = await getDocs(collection(db,"habits"));
  let totalRunning=0,totalReading=0,totalStudy=0;

  snapshot.forEach(doc=>{
    const d=doc.data();
    totalRunning+=d.running||0;
    totalReading+=d.reading||0;
    totalStudy+=d.study||0;
  });

  statsBox.innerHTML=`
  ğŸƒ ${totalRunning} km<br>
  ğŸ“š ${totalReading} trang<br>
  â± ${totalStudy} giá»
  `;
}
</script>

</body>
</html>
